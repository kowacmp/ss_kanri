<%= javascript_include_tag "modal" %><!-- モーダルを出すには再読み込みする必要あり -->

<%= form_tag({:action => 'd_result_create' }, { :remote => true }) do %>
<div id="d_result_meter"><%= render 'd_result_meter' %></div><br/>
<div id="d_tank_compute"><%= render 'd_tank_compute' %></div><br/>

  <table id='rounded-corner'>
	<tr>
	  <th width="150">出荷数量(リットル)</th>
	  <th width="105">POS1</th>
	  <th width="105">POS2</th>	
	  <th width="105">POS3</th>
	  <th width="80">POS日計</th>	
	</tr>
  <% @m_oil_totals.each do |m_oil| %>
    <tr>
      <th><%= m_oil.oil_name %></th> 	
      <td><%= number_field :oil_pos1, "#{m_oil.id}", :value => m_oil.pos1_data, :class => "money", :size => 4 %></td>
      <td><%= number_field :oil_pos2, "#{m_oil.id}", :value => m_oil.pos2_data, :class => "money", :size => 4 %></td>
      <td><%= number_field :oil_pos3, "#{m_oil.id}", :value => m_oil.pos3_data, :class => "money", :size => 4 %></td>  
      <td id="oil_total_<%= m_oil.id %>" class="input_no"><%= num_fmt(session[:m_oil_totals][m_oil.id][:total], true) %></td>              
    </tr>  
  <% end %>    
  </table>
  <br/>
  
  <table id='rounded-corner'>
	<tr>
	  <th width="150">油外販売</th>
	  <th width="105">POS1</th>
	  <th width="105">POS2</th>	
	  <th width="105">POS3</th>
	  <th width="80">POS日計</th>	
	</tr>
  <% @oiletc0s.each do |oiletc0| %>
    <tr>
      <th><%= oiletc0.oiletc_name %></th> 	
      <td><%= number_field :etc0_pos1, "#{oiletc0.id}", :value => oiletc0.pos1_data, :class => "money", :size => 4 %>&nbsp;<%= oiletc0.oiletc_tani%></td>
      <td><%= number_field :etc0_pos2, "#{oiletc0.id}", :value => oiletc0.pos2_data, :class => "money", :size => 4 %>&nbsp;<%= oiletc0.oiletc_tani%></td>
      <td><%= number_field :etc0_pos3, "#{oiletc0.id}", :value => oiletc0.pos3_data, :class => "money", :size => 4 %>&nbsp;<%= oiletc0.oiletc_tani%></td>  
      <td class="input_no"><label id="etc0_total_<%= oiletc0.id %>"><%= num_fmt(oiletc0.pos_total, true) %></label>&nbsp;<%= oiletc0.oiletc_tani%></td>              
    </tr>
  <% end %>	
    <tr>
      <th>油外合計</th>
      <td id="etc0_pos1_total" class="input_no"><%= num_fmt(@etc0_pos1_total) %></td>
      <td id="etc0_pos2_total" class="input_no"><%= num_fmt(@etc0_pos2_total) %></td>
      <td id="etc0_pos3_total" class="input_no"><%= num_fmt(@etc0_pos3_total) %></td>
      <td id="etc0_pos_total" class="input_no"><%= num_fmt(@etc0_pos_total) %></td>
    </tr>  
  </table>
  <br/>
  
  <table id='rounded-corner'>
	<tr>
	  <th width="150">その他商品</th>
	  <th width="105">POS1</th>
	  <th width="105">POS2</th>	
	  <th width="105">POS3</th>
	  <th width="80">POS日計</th>	
	</tr>
  <% @oiletc1s.each do |oiletc1| %>
    <tr>
      <th><%= oiletc1.oiletc_name %></th> 	
      <td><%= number_field :etc1_pos1, "#{oiletc1.id}", :value => oiletc1.pos1_data, :class => "money", :size => 4 %>&nbsp;<%= oiletc1.oiletc_tani%></td>
      <td><%= number_field :etc1_pos2, "#{oiletc1.id}", :value => oiletc1.pos2_data, :class => "money", :size => 4 %>&nbsp;<%= oiletc1.oiletc_tani%></td>
      <td><%= number_field :etc1_pos3, "#{oiletc1.id}", :value => oiletc1.pos3_data, :class => "money", :size => 4 %>&nbsp;<%= oiletc1.oiletc_tani%></td>  
      <td class="input_no"><label id="etc1_total_<%= oiletc1.id %>"><%= num_fmt(oiletc1.pos_total) %></label>&nbsp;<%= oiletc1.oiletc_tani%></td>              
    </tr>
  <% end %>	
  </table>
  <br/>
  
  <table id='rounded-corner'>
	<tr>
	  <th width="150">その他売上</th>
	  <th width="105">POS1</th>
	  <th width="105">POS2</th>	
	  <th width="105">POS3</th>
	  <th width="80">POS日計</th>	
	</tr>
  <% @m_etcs.each do |m_etc| %>
    <% if m_etc.d_result_etc_id.blank? %>
      <% for i in 1..m_etc.max_num %>
      <tr>
        <th><%= m_etc.etc_name %></th> 	
        <td><%= number_field :m_etc_pos1, "#{m_etc.id}_no#{i}", :value => m_etc.pos1_data, :class => "money", :size => 4 %>&nbsp;<%= m_etc.etc_tani%></td>
        <td><%= number_field :m_etc_pos2, "#{m_etc.id}_no#{i}", :value => m_etc.pos2_data, :class => "money", :size => 4 %>&nbsp;<%= m_etc.etc_tani%></td>
        <td><%= number_field :m_etc_pos3, "#{m_etc.id}_no#{i}", :value => m_etc.pos3_data, :class => "money", :size => 4 %>&nbsp;<%= m_etc.etc_tani%></td>  
        <td class="input_no"><label id="m_etc_total_<%= m_etc.id %>_no<%= i %>"><%= num_fmt(m_etc.pos_total) %></label>&nbsp;<%= m_etc.etc_tani%></td>              
      </tr>
      <% end %>
    <% else %>
      <tr>
        <th><%= m_etc.etc_name %></th> 	
        <td><%= number_field :m_etc_pos1, "#{m_etc.id}_no#{m_etc.no}", :value => m_etc.pos1_data, :class => "money", :size => 4 %>&nbsp;<%= m_etc.etc_tani%></td>
        <td><%= number_field :m_etc_pos2, "#{m_etc.id}_no#{m_etc.no}", :value => m_etc.pos2_data, :class => "money", :size => 4 %>&nbsp;<%= m_etc.etc_tani%></td>
        <td><%= number_field :m_etc_pos3, "#{m_etc.id}_no#{m_etc.no}", :value => m_etc.pos3_data, :class => "money", :size => 4 %>&nbsp;<%= m_etc.etc_tani%></td>  
        <td class="input_no"><label id="m_etc_total_<%= m_etc.id %>_no<%= m_etc.no %>"><%= num_fmt(m_etc.pos_total) %></label>&nbsp;<%= m_etc.etc_tani%></td>             
      </tr>      
    <% end %>
  <% end %>	
  </table>	
  <br/>
  
  <table>  
    <td valign="top"><div id="d_result_yume"><%= render 'd_result_yume' %></div></td>
    <% if @m_shop.shop_kbn == 1 %> <!-- 油外店のみ表示 -->
      <td valign="top"><div id="d_result_reserve"><%= render 'd_result_reserve' %></div></td>
      <td valign="top">
        <table id='rounded-corner'>
	      <tr>
	        <th colspan="2">営業POS伝回収報告</th>
	      </tr>
	      <tr>  
	        <th></th>
	        <th>日計</th>
	      </tr>
          <% @m_oil_etcs.each do |m_oil_etc| %>
            <tr>
              <th><%= m_oil_etc.oiletc_name %></th> 	
              <td><%= number_field :get_num, "#{m_oil_etc.id}", :value => m_oil_etc.get_num, :class => "money", :size => 4 %></td>            
            </tr>
          <% end %>	
        </table>
      </td>
    <% end %>
  </table>  
  <br/>  
      
  <%= hidden_field :select, :result_date, :value => @result_date %>
  <div style="text-align:right; width: 550px;"><%= submit_tag '登録' %></div>
<% end %>


<script>
$(function () {
    //保存の時に金額はカンマを消す
    $("form").submit(function() {
    	
         	//金額欄のカンマを消す
         	$("input.money").each(function(){
         		var num = new String($(this).val()).replace(/,/g, "");
           		$(this).val(num); 
         	});
         	
     	
    });

    //カンマ編集して表示する
 	$("input.money").each(function(){
	    var num = new String($(this).val()).replace(/,/g, "");
	    while(num != (num = num.replace(/^(-?\d+)(\d{3})/, "$1,$2")));
	    $(this).val(num); 
 	});

})();	
</script>