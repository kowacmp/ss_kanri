<% sum_receive = 0 
   sum_compute_stock = 0
   sum_decrease = 0
   last_sale_total = 0
   sum_decrease_total = 0
   %>
<% get_ymd = @from_ymd %>
<% start_ymd = (@from_ymd[0,4].to_s + '/' + @from_ymd[4,2] + '/' + @from_ymd[6,2]).to_time %>
<% start_day = start_ymd.end_of_month.day %>
<table id="rounded-corner">
<tr>
	<th colspan="2" rowspan="3"><%= @from_ymd[0,4]%>年<br /><%= @from_ymd[4,2].to_i %>月</th>
	<th>検査官<br />点検</th>
	<th>前日営業<br />終了後の<br />実在庫量</th>
    <th>ローリー<br />からの<br />受入数量</th>
    <th>計量機<br />からの<br />販売数量</th>
    <th>計量<br />在庫量</th>
    <th>当日営業<br />終了後の<br />実在庫量</th>
    <th>本日の<br />増減</th>
    <th>計量機<br />からの<br />販売累計</th>
    <th>増減の<br />累計</th>
    <th>累計<br />増減率</th>
</tr>
<tr>
	<th rowspan="2">（注）</th>
    <th>A</th>
    <th>B</th>
    <th>C</th>
    <th>D</th>
    <th>E</th>
    <th>F</th>
    <th>G</th>
    <th>H</th>
    <th>I</th>
</tr>
  <tr>
    <th></th>
    <th></th>
    <th></th>
    <th>A+B-C</th>
    <th></th>
    <th>E-D</th>
    <th>前日のG+C</th>
    <th>前日のH+F</th>
    <th>(H/G)%</th>
  </tr>
  <tr>
    <th colspan="2">前月末</th>
    <td></td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
<% start_day.times do |i| %>
<% result = DResult.find(:all,:conditions => ['result_date = ? and m_shop_id = ?',get_ymd,current_user.m_shop_id]).first %>
<% get_ymd = (get_ymd.to_i + 1).to_s %>
  <% unless @oil_id == nil %><!-- 油種の場合-->
  <% tank_compute = get_select_oil(result.id,@oil_id,current_user.m_shop_id) unless result == nil %>
  	<% end %>
  <% unless @tank_id == nil %><!-- タンクの場合-->
  <% tank_compute = DTankComputeReport.find(:all,:conditions => ['d_result_id = ? and m_tank_id = ?',
  	result.id,@tank_id]).first unless result == nil %>
  	<% end %>
<tr>
	<th><center><%= i + 1 %></center></th>
	<th><center><%= day_of_the_week(start_ymd.wday) %><% start_ymd = start_ymd.tomorrow %></center></th>
	<td>
		<% unless tank_compute == nil %>
		  <% if tank_compute.inspect_flg > 0 %>
		  ○
		  <% end %>
		<% end %>
	</td>
	<td><%= tank_compute.before_stock unless tank_compute == nil %></td>
	<td><% unless tank_compute == nil %>
		  <%= tank_compute.receive %>
		  <% sum_receive = sum_receive + tank_compute.receive %>
		<% end %>
	</td>
	<td><%= tank_compute.sale unless tank_compute == nil %></td>
	<td><% unless tank_compute == nil %>
		  <%= tank_compute.compute_stock  %>
		  <% sum_compute_stock = sum_compute_stock + tank_compute.compute_stock %>
		<% end %>
	</td>
	<td><%= tank_compute.after_stock unless tank_compute == nil %></td>
	<td><% unless tank_compute == nil %>
		  <%= tank_compute.decrease %>
		  <% sum_decrease = sum_decrease + tank_compute.decrease %>
		<% end %>
	</td>
	<td><% unless tank_compute == nil %>
	  	  <%= tank_compute.sale_total %>
	  	  <% last_sale_total = tank_compute.sale_total %>
		<% end %>
	</td>
	<td><% unless tank_compute == nil %>
		  <%= tank_compute.decrease_total %>
		  <% sum_decrease_total = sum_decrease_total + tank_compute.decrease_total %>
		<% end %>
	</td>
	<td><%= sprintf("%-8.3f",(tank_compute.decrease_total*1.000 / tank_compute.sale_total*1.000)*100) + "%" unless tank_compute == nil %></td>
</tr>
<%#= result.result_date %>
<% end %>
<tr>
	<th colspan="3">月間累計</th>
	<td></td>
	<td><%= sum_receive %></td>
	<td></td>
	<td><%= sum_compute_stock %></td>
	<td></td>
	<td><%= sum_decrease %></td>
	<td><%= last_sale_total %></td>
	<td><%= sum_decrease_total %></td>
	<td><%= sprintf("%-8.3f",(sum_decrease_total * 1.000 / last_sale_total * 1.000)*100) + "%"%></td>
</tr>
</table>