<%=form_tag({:action => 'update' }, :id => "form_update") do%>

<!-- 検索パラメータ -->
<%=hidden_field :header, :kansa,       :value => params[:header][:kansa] %>
<%=hidden_field :header, :shop_kbn,    :value => params[:header][:shop_kbn] %>
<%=hidden_field :header, :audit_class, :value => params[:header][:audit_class] %>
<%=hidden_field :header, :zumi_flg,    :value => params[:header][:zumi_flg] %>

<!-- 書き込み先の情報を付加 -->
<%=hidden_field :approval, :table,         :value => @table %>
<%=hidden_field :approval, :approval_id,   :value => @approval_id %>
<%=hidden_field :approval, :approval_name, :value => @approval_name %>

<table class='rounded-corner' >

	<tr>
		<td colspan="8" align="right" style="border: none;">
			<input type="button" value=" 　一括 　" onclick="return chk_flgs_all(true);" ><br/>
			<input type="button" value="一括クリア" onclick="return chk_flgs_all(false);">
		</td>
	</tr>

	<tr>
		<th>店舗</th>
		<th>監査日</th>
		<th>処理</th>
		<th>種別</th>
		<th>監査人</th>
		<th>立会人</th>
		<th>詳細</th>
		<th>承認</th>
	</tr>
	
	<% rec_cnt = 0 %>
	<% for approval in @approval do %>
		<% rec_cnt += 1 %>

		<tr>
			<td align="center">
				<% m_shop = MShop.find(approval.m_shop_id) %>
				<%= m_shop.shop_cd %>
				&nbsp;
				<%= m_shop.shop_name %>
			</td>
			<td align="center">
				<%dt=approval.audit_date%>
				<%=dt[0..3] + "/" + dt[4..5] + "/" + dt[5..6] %>
			</td>
			<td align="center">
				<% # TODO : あとで変換すること %>
				釣り銭監査
			</td>
			<td align="center">
				<%=MCode.find(:first, :conditions=>["kbn='shop_kbn' and code=?", params[:header][:shop_kbn]]).code_name %>
			</td>
			<td align="center">
				<% user = User.find(approval.created_user_id) %>
				<%= user.account %>
				&nbsp;
				<%= user.user_name %>
			</td>
			<td align="center">
				<% user = User.find(approval.confirm_user_id) %>
				<%= user.account %>
				&nbsp;
				<%= user.user_name %>
			</td>
			<td align="center">
				<a href="../../d_audit_changemachines/edit?readonly=true&back=true&id=<%=approval.id%>">詳細</a>
			</td>
			<td align="center">
			    <%=hidden_field "approval#{rec_cnt}", :id,               :value   =>  approval.id %>
				<%=hidden_field "approval#{rec_cnt}", :old_approval_flg, :value   => (approval.approve_id.to_s != "0") %> 
				<%=check_box    "approval#{rec_cnt}", :approval_flg,     :checked => (approval.approve_id.to_s != "0") %>
			</td>
		</tr>
		
	<% end %> <!-- for approval in @approval do -->
		
	<tr>
		<td colspan="8" align="right" style="border: none">
			<%= submit_tag '　保　存　', :disable_with => "保存中です...", :confirm => "保存してもよろしいですか？" %>
		</td>
	</tr>
		
</table>
<% end %> <!-- form_tag({:action => 'update' }, :id => "form_update") do -->

<script>
	
	// 承認の全てを一括ON/OFFする
	function chk_flgs_all(flg) {
		$(":checkbox[id$=approval_flg]").each(function() {
			this.checked = flg;
		});
		
		return true;
	}
	
</script>